<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Untitled Document</title>



  <link rel="stylesheet" href="../css/foundation.css" />
  <link rel="stylesheet" href="../css/app.css" />
  <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" />
  <style>
  body{
    background:#ecf0f1;
  }
  #lean_overlay {
    position: fixed;
    z-index:100;
    top: 0px;
    left: 0px;
    height:100%;
    width:100%;
    background: #000;
    display: none;
  }
  #habit_input_modal, #current_habit_modal{
    border-radius: 2px;
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;

    width:30%;
    padding: 20px;
    background: white;
    display:none;

  }
  #habit_list{
    list-style: none;
  }

  #habit-section{
    padding-bottom:5%;

  }
  #habit_wrapper{
    /*border:dotted 5px #ecf0f1;*/
    /*border-left:dotted 4px #ecf0f1;*/
    padding-right:2%;
    /*background:#282C34;*/
    padding-top: 10px;
    padding-bottom: 10px;
    margin-left:20%;
    margin-right:40%;
    border-radius: 6px 16px 16px 100px;
    -moz-border-radius: 6px 16px 16px 116px;
    -webkit-border-radius: 6px 16px 16px 100px;
  }
  #habit_list > li{
    border-radius: 2px;
    -moz-border-radius: 2px;
    -webkit-border-radius: 2px;
    padding: 20px;
    margin-top: 10px;
    margin-bottom:10px;
    background: #E74C3C;
  }

  #habit_list > li:hover{
    background:#F25C5C;

  }


  #page_nav{
  }

  #upper-left{
    float:left;
    width:80%;
  }

  #upper-right{
    float:right;
    width: 20%;
  }

  .checkbox-grid li {
    display: block;
    float: left;
    width: 50%;
  }
  .wrapper-Clear{
    overflow: hidden;

  }

  #habit_listing_nav{
    margin-right: 21%;
  }

  </style>


  <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="../js/jquery.leanModal.min.js"></script>

  <script src="../js/foundation.js"></script> <!--switch to min version when launch-->


  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>




</head>


<body>

  <div class="callout small secondary" style = "background:#e74c3c">
    <div class="row">
      <div class="large-4 columns" >
        <h5>Our Goal</h5>
        <p>To motivate positive attutide and habit through discripline</p>
      </h4>
    </div>
    <div class="large-3 large-offset-2 columns">
      <ul class="menu vertical">

      </ul>
    </div>
    <div class="large-3 columns">
      <ul class="menu vertical">

      </ul>
    </div>
  </div>
</div>



  <div class = "wrapper-Clear">

    <div id = "upper-left">


      <div id = "habit_listing">
      </div>

      <div id ="new_habit_popup">
      </div>


    </div>

    <div id = "upper-right">
      reward places

    </div>

  </div>
  <div class="callout large secondary" style = "background:#e74c3c">
    <div class="row">
      <div class="large-4 columns" >
        <h5>Our Goal</h5>
        <p>To motivate positive attutide and habit through discripline</p>
      </h4>
    </div>
    <div class="large-3 large-offset-2 columns">
      <ul class="menu vertical">
        <li><a href="#">Contact Us</a></li>
        <li><a href="#">Two</a></li>
        <li><a href="#">Three</a></li>
        <li><a href="#">Four</a></li>
      </ul>
    </div>
    <div class="large-3 columns">
      <ul class="menu vertical">
        <li><a href="#">One</a></li>
        <li><a href="#">Two</a></li>
        <li><a href="#">Three</a></li>
        <li><a href="#">Four</a></li>
      </ul>
    </div>
  </div>
</div>

  <script type="text/jsx">
  var app = app || {};
  /** @jsx React.DOM */
  (function(){
    "use strict";

    app.DISPLAYING_AMOUNT = 3;
    app.Daily = 1;
    app.Weekly = 2;
    app.BiWeekly = 3;

    //this Component is only for storing the habits data from server
    //the root component for the habit listing section
    var HabitModel = React.createClass({
      getInitialState: function(){
        return {
          data: []
        };
      },
      componentDidMount: function(){
        console.log("let's mount");
        this.serverRequest = $.get(this.props.source, {userid:123}, function(result){
          result = JSON.parse(result);
          this.setState({
            data: result
          });
          console.log("finish mount");
        }.bind(this));
      },
      render: function() {
        console.log("let's render");
        return (
          <div>
          <NavHabit dataList={this.state.data} />
          </div>
        );
      }
    });

    //This is the immediate child of root
    var NavHabit = React.createClass(
      {
        getInitialState: function(){
          return{
            pageNum: 1,
            currentHabit: []
          }
        },
        handleUserClick: function(pageFlip){
          if ( (this.state.pageNum != 1 || pageFlip != -1) &&
          (this.state.pageNum != Math.ceil(this.props.dataList.length/app.DISPLAYING_AMOUNT) || pageFlip != 1)){
            this.setState({
              pageNum: this.state.pageNum + pageFlip
            });
          }
        },
        handleCurrentHabit: function(data){
          this.setState({
            currentHabit: data
          });
        },
        render: function(){
          return (
            <div>
            <HabitList
            pageNumber={this.state.pageNum}
            list={this.props.dataList}
            onHabitClick={this.handleCurrentHabit}
            />
            <PageNav
            onUserClick={this.handleUserClick}
            currentPageNum={this.state.pageNum}
            maxPage={Math.ceil(this.props.dataList.length/app.DISPLAYING_AMOUNT)}
            />
            <CurrentHabit
            habit={this.state.currentHabit}
            />
            </div>
          )
        }
      });

      var HabitList = React.createClass({

        //this callback is to tell parent (NavHabit) which habit is clicked, so CurrentHabit component will render the selected habit info
        handleCurrentHabit: function(data){
          this.props.onHabitClick(data);
        },

        render: function(){
          var newList = [];
          //get the current page number from parent(NavHabit) so we can determine which habits to display
          var start = (this.props.pageNumber-1) * app.DISPLAYING_AMOUNT;
          var end = start + app.DISPLAYING_AMOUNT - 1;

          //pushing the habit item that need to display to newList
          for (var i=start; i <= end; i++){
                newList.push(this.props.list[i]);
          }

          return (
              <div id="habit-section">habit list follows:
                <div id = "habit_wrapper">
                  <ul id = "habit_list">
                  {   newList.map(function(dataRow, i) { //mapping each habit that need to display to a li element, and whenever each item is clicked it will trigger a modal
                    if (dataRow != undefined){
                      console.log("add habits display");
                      return  <li className="habits_display" key={i} onClick={this.handleCurrentHabit.bind(this, dataRow)} href="#current_habit_modal">{dataRow.description}</li>
                    }else{
                      return <li className="habits_display" key={i} href="#current_habit_modal"></li>
                    }
                  }, this)
                  //each list habit item can trigger the modal to appear when clicked, this is made possible with a Jquery plugin that get initialize later on
                }
                <hr></hr>
                    <li className = " text-center" id="add_more" style = {{marginTop: '30px', marginLeft: '8px', borderRadius: '6px 16px 16px 116px', MozBorderRadius: '6px 16px 16px 116px', WebkitBorderRadius: '6px 16px 16px 116px'}} href="#habit_input_modal">add more</li>
                  </ul>
                </div>
              </div>
          );
        }
      });

      //Direct child of NavHabit, use to handle the Page number
      var PageNav = React.createClass({
        handleClicks: function(page){
          this.props.onUserClick(page);
        },
        render: function(){
          var prevClassName = "";
          var nextClassName = "";
          if(this.props.currentPageNum == 1){
                prevClassName = "pagination-previous disabled";
                nextClassName = "pagination-next";
          }else if(this.props.currentPageNum == this.props.maxPage){
                prevClassName = "pagination-previous";
                nextClassName = "pagination-next disabled";
          }else{
                prevClassName = "pagination-previous";
                nextClassName = "pagination-next";
          }
          return(
            <div id = "habit_listing_nav">
              <ul className="pagination text-center" role="navigation" aria-label="Pagination">
                <li className={prevClassName} onClick={this.handleClicks.bind(this, -1)}>
                {(this.props.currentPageNum == 1
                    ? "Previous"
                    : <a>Previous</a>
                  )}
                </li>
                <li className={nextClassName} onClick={this.handleClicks.bind(this, 1)}>
                  {(this.props.currentPageNum == this.props.maxPage
                      ? "Next"
                      : <a>Next</a>
                    )}
                </li>
              </ul>
            </div>
          );
        }
      });


      var CurrentHabit = React.createClass({
        render: function(){
          console.log("render current");
          return(
            <div id = "current_habit_modal">
            The habit you clicked on is:
            <br/>
            description:
            {this.props.habit.description} <br/>
            start day: {this.props.habit.startDate} <br/>
            goal day: {this.props.habit.goalDate} <br/>
            </div>
          )
        }
      });

      app.habitListing = React.render(
        <HabitModel source = "/health1/server/habit/user"/>,
        document.getElementById('habit_listing')
      );




/////////////////////////////////////////////////////////////////////////////
      var formModel = {
          newHabitInfo: {
              description: "",
              frequency: "",
              startDay: "",
              days: []
          },
          addDescription: function(description){
            this.newHabitInfo.description = description;
          },
          addFrequency: function(selection){
            this.newHabitInfo.frequency = selection;
          },

          addStartDay: function(startDay){
            this.newHabitInfo.startDay = startDay;
          },
          addDays: function(day){
            var found = false;
            var length = this.newHabitInfo.days.length;
            for (var i = 0; i< length; i++){
              if(this.newHabitInfo.days[i]==day){//the changed checkbox existed in array, so this mean the user unchecked the box, so we take it out of array
                 this.newHabitInfo.days.splice(i, 1); //delete it
                 found = true;
                 break;
              }
            }
            (!found) ? this.newHabitInfo.days.push(day) : console.log("we found it"); //if we didnt find item in array we add it in
            console.log(this.newHabitInfo.days)
          },
          getDays: function(){
            return this.newHabitInfo.days;
          },
          getFrequency: function(){
            return this.newHabitInfo.frequency;
          },
          getDescription: function(){
            return this.newHabitInfo.description;
          },

          getStartDay: function(){
            return this.newHabitInfo.startDay;
          },
          clearModel: function(){
            this.newHabitInfo.description = "";
            this.newHabitInfo.frequency = "";
            this.newHabitInfo.days = [];
          },
          //ajax call to server api and add the new habit to database
          //if successful update the model root (display original habit list and this new one)
          //also clear formHabit so new habit can be added
          updateHabitListing: function(){
              if(this.validate()){
                console.log(this.newHabitInfo.days.join(""));
              //app.habitListing.forceUpdate();
                var newHabitData = {
                                    userid: '123',
                                    description: this.newHabitInfo.description,
                                    frequency: this.newHabitInfo.frequency,
                                    startDay: this.newHabitInfo.startDay,
                                    days: this.newHabitInfo.days.join("")
                                    }
                $.post("/health1/server/habit/user", newHabitData, function(data){
                  console.log(data);
                });
              }else{
                console.log("form not finish");
              }
          },

          validate: function(){
            return (this.newHabitInfo.description != "" && this.newHabitInfo.frequency!="" && this.newHabitInfo.startDay!="" && this.newHabitInfo.days.length!=0)
          }
      }




      var AddingNewHabit = React.createClass({

        getInitialState: function(){
          return{
            progress: 0
          }
        },

        handleUserClick: function(direction){ //direction is either -1:left or 1:right
          var progressIncrement = 0;
          if(direction==-1 && this.state.progress!=0){
            progressIncrement = -25;
          }else if(direction==1 && this.state.progress!=100){
            progressIncrement = 25;
          }
          this.setState({progress: this.state.progress + progressIncrement});

        },

        render: function(){
          return(

            <div id="habit_input_modal">
              <div id="instruction_header">
                <div className="success progress" role="progressbar" tabIndex={0} aria-valuenow={25} aria-valuemin={0} aria-valuetext="25 percent" aria-valuemax={100}>
                  <ProgressBar progress={this.state.progress} />
                </div>
                <div className="wrapper-Clear">
                <div style={{float: 'left'}}>
                <p>Hi there...</p>
                </div>
                <div id = "new_habit_navigate" style={{float: 'right'}}>
                  <NaviForm onUserNavi = {this.handleUserClick}
                            progress = {this.state.progress}
                  />
                </div>
                </div>
              </div>

              <NewHabitForm progress={this.state.progress}/>

            </div>
          )
        }

      });

      var NaviForm = React.createClass({
          userClick: function(direction){
            this.props.onUserNavi(direction);
          },
          render: function(){
            return(
              <div>
                <button style = {{marginRight: '10%'}} onClick={this.userClick.bind(this, -1)}>
                  {this.props.progress!=0 ?
                    "Previous"
                    : <div style={{color: '#95a5a6'}}>Previous</div>
                  }
                </button>
                <button onClick={this.userClick.bind(this, 1)}>
                  {this.props.progress!=100 ?
                    "Next"
                    : <div style={{color: '#95a5a6'}}>Next</div>
                  }
                </button>
              </div>
            )
          }
      });

      var ProgressBar = React.createClass({
        render: function(){
          var progress = this.props.progress;
          return(
            <div className="progress-meter" style={{width: progress+'%'}} />
          )
        }
      });

      var NewHabitForm = React.createClass({
          getInitialState: function(){
            return{
              questions:["What is your new habit description?",
              "how often do you plan to do this?",
              "which days of a week?",
              "When is/was your start day",
              "You are done! hit submit and start your development"]
            }
          },

          render: function(){
            var questionNum= this.props.progress / 25;
            return(
              <div id="habit_input_body">
                <QuestionDisplay question={this.state.questions[questionNum]}
                                 questionNum={questionNum}
                />

                {/*decide which form to show client to fill in*/}
                {this.props.progress==0 ?
                  <NewHabitInputBox type = {"description"}
                                    getValue = {formModel.getDescription} //callback f
                                    setValue = {formModel.addDescription} //callback f
                  />
                  : this.props.progress==25 ?
                      <FrequencyForm />
                    : this.props.progress==50 ?
                        <DaysForm />
                        : this.props.progress==75 ?
                            <NewHabitInputBox type = {"startDay DD-MM-YY"}
                                          getValue = {formModel.getStartDay} //callback f
                                          setValue = {formModel.addStartDay} //callback f
                            />
                            : this.props.progress==100 ?
                              <SubmitNewHabit />
                              : console.log("error")
                              }
              </div>
            )}
      });

      var SubmitNewHabit = React.createClass({
        render: function(){
          console.log("came");
          return(
            <button onClick={formModel.updateHabitListing.bind(formModel)}> click me </button>

          )}

      });


      var NewHabitInputBox = React.createClass({
        userInput: function(event){
          var setValue = this.props.setValue.bind(formModel);
          setValue(event.target.value);
        },
        render: function(){
          var getValue = this.props.getValue.bind(formModel);
          return(
            <fieldset className="fieldset">
            <legend>{this.props.type}</legend>
            <input type="test" defaultValue={getValue()} onChange={this.userInput}/>
            </fieldset>
          )
        }
      });

      var FrequencyForm = React.createClass({
        userInput: function(selection){
          formModel.addFrequency(selection);
        },

        render: function(){
          return(
            <fieldset className="fieldset">
            <legend>How Often?</legend>
            <input type="radio" name="HowOften" id="Daily" onChange={this.userInput.bind(this, app.Daily)} defaultChecked = {formModel.getFrequency() == app.Daily}/><label htmlFor="Daily">Daily</label>
            <input type="radio" name="HowOften" id="Weekly" onChange={this.userInput.bind(this, app.Weekly)} defaultChecked = {formModel.getFrequency() == app.Weekly}/><label htmlFor="Weekly">Weekly</label>
            <input type="radio" name="HowOften" id="BiWeekly" onChange={this.userInput.bind(this, app.BiWeekly)} defaultChecked = {formModel.getFrequency() == app.BiWeekly}/><label htmlFor="BiWeekly">Bi-Weekly</label>
            </fieldset>
          )
        }

      });
      var DaysForm = React.createClass({
        userInput: function(day){
          console.log("clicked on" + day);
          formModel.addDays(day);
        },

        render: function(){
          return(
            <fieldset className="fieldset">
            <legend>Which days?</legend>
            <ul className ="checkbox-grid">
            <li><input id="Monday" type="checkbox" onClick={this.userInput.bind(this, 1)} defaultChecked={formModel.getDays().indexOf(1) > -1}/><label >Monday</label></li>
            <li><input id="Tuesday" type="checkbox" onClick={this.userInput.bind(this, 2)} defaultChecked={formModel.getDays().indexOf(2) > -1} /><label >Tuesday</label></li>
            <li><input id="Wednesday" type="checkbox" onClick={this.userInput.bind(this, 3)} defaultChecked={formModel.getDays().indexOf(3) > -1} /><label >Wednesday</label> </li>
            <li><input id="Thursday" type="checkbox" onClick={this.userInput.bind(this, 4)} defaultChecked={formModel.getDays().indexOf(4) > -1} /><label >Thursday</label></li>
            <li><input id="Friday" type="checkbox" onClick={this.userInput.bind(this, 5)} defaultChecked={formModel.getDays().indexOf(5) > -1} /><label >Friday</label></li>
            <li><input id="Saturaday" type="checkbox" onClick={this.userInput.bind(this, 6)} defaultChecked={formModel.getDays().indexOf(6) > -1} /><label >Saturaday</label></li>
            <li><input id="Sunday" type="checkbox" onClick={this.userInput.bind(this, 7)} defaultChecked={formModel.getDays().indexOf(7) > -1} /><label >Sunday</label></li>
            </ul>
            </fieldset>
          )
        }
      });

      var QuestionDisplay = React.createClass({

          render: function(){
            var display = "";
            if (this.props.questionNum == 2){
              display = formModel.getFrequency();
             (display !="" ) ? display = display + "! cool, but " + this.props.question : display = "You should go back and choose the frequency first!";
              }else{
                display = this.props.question;
              }
            return <p>{display}</p>
          }

      });


      React.render(
        <AddingNewHabit />,
        document.getElementById('new_habit_popup')
      );

      // var PostToServer = React.createClass({
      //
      // });

    })();


    console.log("ini modal");
    $("#add_more").leanModal({ top : 200, overlay : 0.8, closeButton: ".modal_close" });
    $(".habits_display").leanModal({ top : 200, overlay : 0.8, closeButton: ".modal_close" });
console.log("end modal");


    </script>
  </body>
  </html>
